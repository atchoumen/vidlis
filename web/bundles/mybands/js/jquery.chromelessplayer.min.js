
(function(d){
	d.fn.chromelessplayer=function(p){
	var q={
		videoWidth:"388",
		videoHeight:"163",
		videoIdBase:"ytplayer",
		params:
			{
				allowScriptAccess:"always",
				wmode:"transparent",
				allowFullScreen:"true"
			}
	};
	var leftIndic;
	return this.each(function(r){
	
	var f=d.extend(q,p),
	g=d(this),
	
	s=g.attr("href"),
	e=g.attr("id")||f.videoIdBase+r,
	t=s.substr(31),
	lec=s.substr(11,3),
	a=g.wrap('<div class="video-player" id="'+e+'div"></div>').parent(),
	h=d('<div class="video-controls"></div>').appendTo(a);
	cl=d('<div class="video-close b btn shadow" onclick="$(\'#'+e+'div\').css(\'display\', \'none\')">fermer</div>').appendTo(a);
	d('<div class="video"></div>').prependTo(a).attr("id",e);
	var m,n,o,pl,i,j,k,b,t,tI,vb,vI,vBs;a.bind(
			{
				togglePlay:function(){
					a.togglePlay()
				},
			play:function(){
				a.play()
			},
			pause:function(){
				a.pause()
			},
			toggleMute:function(){
				a.toggleMute()
			},
			mute:function(){
				a.mute()
			},
			unMute:function(){
				a.unMute()
			},
			setVolume:function(){
				a.setVolume()
			},
			getVolume:function(){
				a.getVolume()
			},
			seek:function(){
				a.seek()
			},
			update:function(){
				a.update()
			},
			cue:function(){
				b.cueVideoById(t)
			}
		}
		);
		less=function(s){
			return s.substr(0,s.length-2);
		};
		onClose=function(){
			if(document.fullscreen == false) {
                document.cancelFullScreen();
				document.getElementById(e).width = f.videoWidth;
				document.getElementById(e).height = f.videoHeight;
			} else if(document.webkitIsFullScreen == false) {
                document.webkitCancelFullScreen();
				document.getElementById(e).width = f.videoWidth;
				document.getElementById(e).height = f.videoHeight;
			} else if(document.mozFullScreen == false){
                document.mozCancelFullScreen();
				document.getElementById(e).width = f.videoWidth;
				document.getElementById(e).height = f.videoHeight;
			}
		}
		toTime=function(secs) {
			secs = Math.round(secs);
			var hr = Math.floor(secs / 3600);
			var min = Math.floor((secs - (hr * 3600))/60);
			var sec = secs - (hr * 3600) - (min * 60);
			if (hr) addZero(hr) += ':';
			return hr + min + ':' + addZero(sec);
		}
		addZero=function(n){
			if(n<10){
				return ('0'+n);
			}else{
				return n;
			}
		};
		a.togglePlay=function(){
			j.hasClass("playing")?a.trigger("pause"):a.trigger("play");
			return false
		};
		a.play=function(){
			b.playVideo();
			j.removeClass("paused").addClass("playing").attr("title","Pause")
		};
		a.pause=function(){
			b.pauseVideo();
			j.removeClass("playing").addClass("paused").attr("title","Play")
		};
		a.toggleMute=function(){
			i.hasClass("muted")?a.trigger("unMute"):a.trigger("mute");
			return false
		};
		a.mute=function(){
			b.mute();
			i.addClass("muted").attr("title","Un-Mute")
		};
		a.unMute=function(){
			b.unMute();
			i.removeClass("muted").attr("title","Mute")
		};
		a.setVolume=function(c,l){
			w = parseInt(less(vI.css('width')));
			lft = c-(w/2);
			vI.css("left",lft+"px");
			vBs.css("width", c+"px");
			b.setVolume((c/l)*100);
		}
		a.getVolume=function(c,l){
			b.getVolume();
		}
		a.seek=function(c){
			c=Math.round(b.getDuration()*c);
			b.seekTo(c)
		};
		a.update=function(){
			if(b&&b.getDuration){
				if(b.getPlayerState()===1)
					a.play();
				else b.getPlayerState()===0&&a.pause();
				if(b.getVideoBytesLoaded()>-1){
					var c=b.getVideoBytesLoaded()/b.getVideoBytesTotal()*100;
					o.css("width",c+"%")
				}
				if(b.getCurrentTime()>0){
					c=b.getCurrentTime()/b.getDuration();
					px = (c*less(m.css("width")))+ parseInt(less(leftIndic));
					n.css("left",px+"px");
					pl.css("width",(c*100)+"%");
					tI.html(toTime(b.getCurrentTime()) + "/" + toTime(b.getDuration()));
				}
			}
		};
		onYouTubePlayerReady=function(c){
			var l=d(document.getElementById(c)).parent();
			setInterval(function(){l.trigger("update")},250);
			l.trigger("cue")
		};
		onDailymotionPlayerReady = function(c) {
    		var l=d( document.getElementById(c)).parent();
    		setInterval(function(){l.trigger('update')}, 250);  
			l.trigger('cue');
        };
		a.init=function(){
  		  if(lec == 'you'){
			swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3&enablejsapi=1&playerapiid="+e,
			e,
			f.videoWidth,
			f.videoHeight,
			"8",
			null,
			null,
			f.params,
			{id:e},
			function(){
				b=document.getElementById(e)
			}
			);
			}else if(lec == 'dai'){
			t=t.substr(2);
		    swfobject.embedSWF(
            'http://www.dailymotion.com/swf/'+t+'?chromeless=1&enableApi=1&playerapiid=' + e,
            e, 
            f.videoWidth, 
            f.videoHeight, 
            '8', 
            null, 
            null, 
            f.params, 
            { id: e },
            function(){
              b=document.getElementById( e );
            }
          );
		  }
			a.addControls()
		};
			a.addControls=function(){
			j=d("<a/>",
			{href:"#",
			"class":"play-pause",
			text:"Play/Pause",
			title:"Play",
			click:function(){
				a.trigger("togglePlay");
				return false}
			}).appendTo(h);
			i=d("<a/>",
				{href:"#",
				"class":"volume",
				text:"Volume",
				title:"Mute",
				click:function(){
					a.trigger("toggleMute");
					return false}
				}).appendTo(h);
			g.addClass("view-youtube").attr("title","View on YouTube").html("").appendTo(h);
					m=d('<div class="bar"></div>').appendTo(h);
			k=d("<div/>",
				{"class":"status",
				click:function(c){
					c=c.pageX-k.offset().left;
					var l=.kwidth();
					a.seek(c/l)
				}
				}).appendTo(h);
					vb=d('<div/>',
						{"class":"volumeBar",
						click:function(c){
							c=c.pageX-vb.offset().left;
							var l=vb.width();
							a.setVolume(c,l);
						}
						}).appendTo(h);
					tI=d('<div class="currentTime"></div>').appendTo(h);
					vBs=d('<div class="volumeBarSet"></div>').appendTo(vb);
					vI=d('<div class="volumeIndicator"></div>').appendTo(vb);
					o=d('<div class="loaded"></div>').appendTo(k);
					pl=d('<div class="played"></div>').appendTo(k);
					n=d('<span class="indicator"></span>').appendTo(k);
					fS=d('<div/>',
						{"class":"fullScreen",
						click:function(c){
							var element = document.getElementById(e+'div');
							if(element.requestFullScreen) {
								element.onfullscreenchange = onClose;
								document.getElementById(e).width = $(window).width()+20;
								document.getElementById(e).height = $(window).height();
								element.requestFullScreen();
							} else if(element.webkitRequestFullScreen) {
								element.onwebkitfullscreenchange = onClose;
								document.getElementById(e).width = $(window).width()+20;
								document.getElementById(e).height = $(window).height();
								element.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
							} else if(element.mozRequestFullScreen){
								element.onmozfullscreenchange = onClose;
								document.getElementById(e).width = $(window).width()+20;
								document.getElementById(e).height = $(window).height();
								element.mozRequestFullScreen();
							} else {
								alert('Votre navigateur ne supporte pas le mode plein écran, il est temps de passer à un plus récent ;)');
							}
							
							
						}
						}).appendTo(h);
					leftIndic = n.css('left');
			};
			a.init()
		})
	}
})(jQuery);
