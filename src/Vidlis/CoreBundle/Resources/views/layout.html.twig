{% extends "::base.html.twig" %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/style.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/player.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/leaflet.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/icones.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/bootstrap.min.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/mCustomScrollbar.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/Vidlis/css/responsive.css') }}" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <script src="//www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load("swfobject", "2.1");
    </script>
{% endblock %}



{% block javascripts %}
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/lecteur.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/leaflet.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/jquery.address-1.5.min.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/jPlayer/jquery.jplayer.min.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/scrollbar/jquery.easing.1.3.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/scrollbar/jquery.mousewheel.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/scrollbar/jquery.mCustomScrollbar.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/bootstrap.min.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/Vidlis/js/master.js') }}"></script>
        <script type="text/javascript" src="http://37.59.63.129:8080/socket.io/socket.io.js"></script>
    	<script>
	(function () {
		$.address.crawlable(1).state('{{ crawlable }}').init(function () {
		}).change(function (e) {
			$.address.state() + decodeURI(e.path).replace(/\/\//, '/');
			show('loading');
			$.ajax({
				url: '{{ domain_name }}'+e.path,
				type: 'POST',
				dataType: 'json',
				cache: true,
				success: function (data, textStatus, jqXHR) {
					document.title = data.title;
					$('#content').html(data.content);
					hide('loading');
                                        setupCustomScrollbar();
				},
				error: function (jqXHR, textStatus, errorThrown) {
					//alert(textStatus);
				}
			});
		});
	})();
      google.setOnLoadCallback(_run);

    function forceLoad(url) {
        show('loading');
        $.ajax({
            url: '{{ domain_name }}'+url,
            type: 'POST',
            dataType: 'json',
            cache: true,
            success: function (data, textStatus, jqXHR) {
                document.title = data.title;
                $('#content').html(data.content);
                hide('loading');
                setupCustomScrollbar();
                return false;
            },
            error: function (jqXHR, textStatus, errorThrown) {
                showError('Oh Mince ! Une erreur est survenue pendant le chargement de la page :\'(');
                return false;
            }
        });
    }
    var user = {
        id : 0,
        videoId : ''
    };
    // On se connecte au serveur
    var socket = io.connect('http://37.59.63.129:8080/');
    socket.on('getLaunched', function (info) {
        $('#'+info.id).remove();
        $.ajax({
            url: '{{ domain_name }}/getVideoInfo/'+info.videoId ,
            type: 'POST',
            dataType: 'json',
            cache: true,
            success: function (data) {
                $.each(data.video.items, function () {
                    $c = $('.infoPlayed .contentPlayed .mCSB_container');
                    $container = $('<div class="launched" id="'+info.id+'"  />');
                    $item = $('<div class="itemLaunched" data-id="' + this.id + '" data-viewcount="' + this.statistics.viewCount + '" data-title="' + this.snippet.title.replace(/"/g, "&quot;") + '" data-channelid="' + this.snippet.title.channelId + '" data-likecount="' + this.statistics.likeCount + '" data-dislikecount="' + this.statistics.dislikeCount + '"/>');
                    $nameTitle = $('<div class="titleLaunched"/>');
                    $playIcon = $('<div class="buttonPlaying"/>');
                    len = this.snippet.title.length;
                    if (len > 46) {
                        title = (this.snippet.title.substr(0, 40) + ' ...');
                    } else {
                        title = this.snippet.title;
                    }
                    $nameTitle.html(title);
                    $nameChannel = $('<div class="channelLaunched"/>');
                    $nameChannel.html('De ' + this.snippet.channelTitle);
                    $nameTitle.append($nameChannel);
                    $thumb = $('<div class="thumbLaunched"/>');
                    $thumb.html('<img src="' + this.snippet.thumbnails.default.url + '" width="64px" />');
                    $item.append($thumb);
                    $item.append($playIcon);
                    $item.append($nameTitle);
                    $container.append($item);
                    $c.prepend($container);
                });
            }
        });
    });
    socket.on('connect', function () {
        socket.emit('connectMe', user);
    });
    socket.on('setUserId', function(id){
       user.id = id;
    });
    socket.on('remove', function(userToRemove){
        $('#'+userToRemove).remove();
    });
    socket.on('getAllLaunched', function (users) {
        $.each(users, function (){
            var infoAllLaunched = this;
            if (infoAllLaunched.videoId != '') {
                $.ajax({
                    url: '{{ domain_name }}/getVideoInfo/'+infoAllLaunched.videoId ,
                    type: 'POST',
                    dataType: 'json',
                    cache: true,
                    success: function (data) {
                        $.each(data.video.items, function () {
                            $c = $('.infoPlayed .contentPlayed .mCSB_container');
                            $container = $('<div class="launched" id="'+infoAllLaunched.id+'" />');
                            $item = $('<div class="itemLaunched" data-id="' + this.id + '" data-viewcount="' + this.statistics.viewCount + '" data-title="' + this.snippet.title.replace(/"/g, "&quot;") + '" data-channelid="' + this.snippet.title.channelId + '" data-likecount="' + this.statistics.likeCount + '" data-dislikecount="' + this.statistics.dislikeCount + '"/>');
                            $nameTitle = $('<div class="titleLaunched"/>');
                            $playIcon = $('<div class="buttonPlaying"/>');
                            len = this.snippet.title.length;
                            if (len > 46) {
                                title = (this.snippet.title.substr(0, 40) + ' ...');
                            } else {
                                title = this.snippet.title;
                            }
                            $nameTitle.html(title);
                            $nameChannel = $('<div class="channelLaunched"/>');
                            $nameChannel.html('De ' + this.snippet.channelTitle);
                            $nameTitle.append($nameChannel);
                            $thumb = $('<div class="thumbLaunched"/>');
                            $thumb.html('<img src="' + this.snippet.thumbnails.default.url + '" width="64px" />');
                            $item.append($thumb);
                            $item.append($playIcon);
                            $item.append($nameTitle);
                            $container.append($item);
                            $c.prepend($container);
                        });
                    }
                });
            } else {
                $('#'+infoAllLaunched.id).remove();
            }
        });
    });
    function launched(videoId) {
        if (typeof socket != 'undefined') {
            user.videoId = videoId
            socket.emit('launch', user);
        }
        return false;
    }
        </script>
{% endblock %}
